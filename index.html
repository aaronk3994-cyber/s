<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>One-Shot Extraction | Pro Edition</title>
    <style>
        :root {
            --bg: #0d1117;
            --panel: rgba(22, 27, 34, 0.9);
            --accent: #58a6ff;
            --gold: #d29922;
            --danger: #f85149;
        }

        body { 
            margin: 0; 
            background: var(--bg); 
            color: white; 
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; 
            display: flex; 
            flex-direction: column; 
            align-items: center; 
            justify-content: center; 
            height: 100vh; 
            overflow: hidden;
        }

        .ui-container {
            display: flex;
            gap: 20px;
            margin-bottom: 15px;
            z-index: 10;
        }

        .stat-card {
            background: var(--panel);
            padding: 10px 20px;
            border-radius: 12px;
            border: 1px solid #30363d;
            box-shadow: 0 4px 15px rgba(0,0,0,0.3);
            text-align: center;
        }

        .label { font-size: 0.7rem; color: #8b949e; text-transform: uppercase; margin-bottom: 4px; }
        .value { font-size: 1.2rem; font-weight: bold; }
        #ammo-status { color: var(--gold); text-shadow: 0 0 8px rgba(210, 153, 34, 0.5); }

        canvas { 
            background: #161b22; 
            border: 2px solid #30363d; 
            border-radius: 10px; 
            cursor: crosshair;
            box-shadow: 0 0 40px rgba(0,0,0,0.5);
        }

        #overlay {
            position: absolute;
            pointer-events: none;
            text-align: center;
            transition: all 0.3s;
        }

        .game-over { color: var(--danger); font-size: 4rem; font-weight: 900; }
    </style>
</head>
<body>

    <div class="ui-container">
        <div class="stat-card"><div class="label">Score</div><div id="score" class="value">0</div></div>
        <div class="stat-card"><div class="label">Best</div><div id="best" class="value">0</div></div>
        <div class="stat-card"><div class="label">Level</div><div id="lvl" class="value">1</div></div>
        <div class="stat-card"><div class="label">Status</div><div id="ammo-status" class="value">READY</div></div>
    </div>

    <div id="overlay"></div>
    <canvas id="gameCanvas" width="900" height="550"></canvas>

<script>
const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');
const overlay = document.getElementById('overlay');

// Game State & Scoring
let score = 0;
let highScore = localStorage.getItem('oneShotHighScore') || 0;
document.getElementById('best').innerText = highScore;

let currentLevel = 1;
let startTime = Date.now();
let shake = 0;

let player = { x: 450, y: 275, size: 22, speed: 4.5, hasAmmo: true, alive: true, flash: 0, angle: 0 };
let bullet = { x: 0, y: 0, vx: 0, vy: 0, active: false, onGround: false, pulse: 0 };
let enemies = [];
let keys = {};

function initLevel(lvl) {
    enemies = [];
    player.x = 450; player.y = 275;
    player.hasAmmo = true;
    bullet.active = false;
    startTime = Date.now();
    
    let enemyCount = 2 + Math.floor(lvl * 1.5); 
    let speedBoost = lvl * 0.15;

    for(let i=0; i<enemyCount; i++) {
        let side = Math.floor(Math.random() * 4);
        let ex, ey;
        if(side === 0) { ex = -30; ey = Math.random()*550; }
        else if(side === 1) { ex = 930; ey = Math.random()*550; }
        else if(side === 2) { ex = Math.random()*900; ey = -30; }
        else { ex = Math.random()*900; ey = 580; }
        enemies.push({ x: ex, y: ey, size: 22, speed: 1.3 + speedBoost, alive: true, angle: 0 });
    }
    document.getElementById('lvl').innerText = lvl;
}

window.addEventListener('keydown', e => keys[e.key.toLowerCase()] = true);
window.addEventListener('keyup', e => keys[e.key.toLowerCase()] = false);
canvas.addEventListener('mousemove', e => {
    const rect = canvas.getBoundingClientRect();
    player.angle = Math.atan2((e.clientY-rect.top)-player.y, (e.clientX-rect.left)-player.x);
});

canvas.addEventListener('mousedown', () => {
    if(player.hasAmmo && player.alive) {
        bullet = { x: player.x, y: player.y, vx: Math.cos(player.angle)*15, vy: Math.sin(player.angle)*15, active: true, onGround: false, pulse: 0 };
        player.hasAmmo = false;
        player.flash = 6;
        shake = 10;
        document.getElementById('ammo-status').innerText = "OUT";
        document.getElementById('ammo-status').style.color = "#f85149";
    }
});

function drawAgent(x, y, angle, color) {
    ctx.save();
    ctx.translate(x, y);
    ctx.rotate(angle);
    ctx.fillStyle = color;
    ctx.fillRect(-12, -12, 24, 24); // Body
    ctx.fillStyle = "white"; // Eyes
    ctx.fillRect(5, -9, 6, 6); ctx.fillRect(5, 3, 6, 6);
    ctx.restore();
}

function update() {
    if(!player.alive) return;

    // Shake Decay
    if (shake > 0) shake *= 0.9;

    // Movement
    if(keys['w'] && player.y > 20) player.y -= player.speed;
    if(keys['s'] && player.y < 530) player.y += player.speed;
    if(keys['a'] && player.x > 20) player.x -= player.speed;
    if(keys['d'] && player.x < 880) player.x += player.speed;

    // Bullet logic
    if(bullet.active && !bullet.onGround) {
        bullet.x += bullet.vx;
        bullet.y += bullet.vy;
        enemies.forEach(en => {
            if(en.alive && Math.hypot(bullet.x-en.x, bullet.y-en.y) < 22) {
                en.alive = false;
                bullet.onGround = true;
                shake = 5;
            }
        });
        if(bullet.x<0 || bullet.x>900 || bullet.y<0 || bullet.y>550) bullet.onGround = true;
    }

    if(bullet.onGround && Math.hypot(player.x-bullet.x, player.y-bullet.y) < 25) {
        player.hasAmmo = true; 
        bullet.active = false;
        document.getElementById('ammo-status').innerText = "READY";
        document.getElementById('ammo-status').style.color = "#d29922";
    }

    // Enemy AI
    let aliveCount = 0;
    enemies.forEach(en => {
        if(en.alive) {
            aliveCount++;
            let ang = Math.atan2(player.y-en.y, player.x-en.x);
            en.x += Math.cos(ang) * en.speed;
            en.y += Math.sin(ang) * en.speed;
            en.angle = ang;
            if(Math.hypot(player.x-en.x, player.y-en.y) < 22) {
                player.alive = false;
                if(score > highScore) {
                    highScore = score;
                    localStorage.setItem('oneShotHighScore', highScore);
                }
                overlay.innerHTML = `<div class="game-over">WASTED</div><div style="font-size:1.5rem">FINAL SCORE: ${score}</div>`;
                setTimeout(() => location.reload(), 3000);
            }
        }
    });

    if(aliveCount === 0) {
        let bonus = Math.max(100, 1000 - Math.floor((Date.now() - startTime)/10));
        score += bonus;
        document.getElementById('score').innerText = score;
        currentLevel++;
        initLevel(currentLevel);
    }
}

function draw() {
    ctx.save();
    // Apply Screen Shake
    if (shake > 0.5) {
        ctx.translate(Math.random()*shake - shake/2, Math.random()*shake - shake/2);
    }

    ctx.clearRect(-10, -10, 920, 570);

    // Draw Bullet
    if(bullet.active) {
        ctx.fillStyle = bullet.onGround ? "gold" : "white";
        if(bullet.onGround) {
            bullet.pulse += 0.15;
            ctx.shadowBlur = 15 + Math.sin(bullet.pulse)*10;
            ctx.shadowColor = "gold";
        }
        ctx.beginPath(); ctx.arc(bullet.x, bullet.y, 6, 0, Math.PI*2); ctx.fill();
        ctx.shadowBlur = 0;
    }

    // Draw Agents
    enemies.forEach(en => { if(en.alive) drawAgent(en.x, en.y, en.angle, "#f85149"); });
    if(player.alive) drawAgent(player.x, player.y, player.angle, "#58a6ff");

    // Muzzle Flash
    if(player.flash > 0) {
        ctx.fillStyle = `rgba(255, 255, 255, ${player.flash/6})`;
        ctx.beginPath(); ctx.arc(player.x + Math.cos(player.angle)*25, player.y + Math.sin(player.angle)*25, 35, 0, Math.PI*2); ctx.fill();
        player.flash--;
    }
    
    ctx.restore();
    requestAnimationFrame(() => { update(); draw(); });
}

initLevel(1);
draw();
</script>
</body>
</html>
